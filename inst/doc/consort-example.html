<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>dtrackr - Consort statement example</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">dtrackr - Consort statement example</h1>



<div id="consort-statement" class="section level1">
<h1>CONSORT statement</h1>
<p>CONSORT diagrams are part of the requirements in reporting parallel group clinical trials or case control designs in observational studies. They are described in the updated 2010 CONSORT statement <span class="citation">(Schulz, Altman, and Moher 2010)</span>. They clarify how patients were recruited, selected, randomised and followed up. For observational studies an equivalent requirement is the STROBE statement <span class="citation">(von Elm et al. 2008)</span>. There are other similar requirements for other types of study such as the TRIPOD statement that are applicable for multivariate models <span class="citation">(Collins et al. 2015)</span>.</p>
<p>As we don’t have to hand a randomised control trial the following example is more geared to reporting observational studies, and uses the Indian Liver Patients disease dataset <span class="citation">(Ramana, Venkateswarlu, and Pradesh, n.d.; Ramana, Babu, and Venkateswarlu 2011; Dua and Graff 2017)</span> as an example.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">#&gt; ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#&gt; ✔ ggplot2 3.3.5     ✔ purrr   0.3.4</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#&gt; ✔ tibble  3.1.6     ✔ dplyr   1.0.7</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt; ✔ tidyr   1.2.0     ✔ stringr 1.4.0</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">#&gt; ✔ readr   2.0.2     ✔ forcats 0.5.1</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw">library</span>(dtrackr)</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt; </span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt; Attaching package: &#39;dtrackr&#39;</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt; The following objects are masked from &#39;package:dplyr&#39;:</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#&gt; </span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">#&gt;     add_count, add_tally, bind_rows</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co">#&gt; The following object is masked from &#39;package:stats&#39;:</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co">#&gt; </span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co">#&gt;     filter</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">#&gt; The following object is masked from &#39;package:utils&#39;:</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co">#&gt; </span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="co">#&gt;     history</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co">#&gt; The following object is masked from &#39;package:base&#39;:</span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="co">#&gt; </span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co">#&gt;     comment</span></span></code></pre></div>
<p>The Indian liver patients data set has some clinical data on a case control study of patients with and without liver disease. We can use to pretend we are conducting an observational study.</p>
<p>Our study criteria are as follows:</p>
<ul>
<li>Entry criteria is having a total bilirubin &gt;= 0.7 for women or &gt;= 0.8 for men.</li>
<li>Patients must be adults aged between the ages of 18 and 80 inclusive.</li>
</ul>
<p>This can be coded into the <code>dplyr</code> pipeline, with additional <code>dtrackr</code> functions:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Some useful formatting options</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>old =<span class="st"> </span><span class="kw">options</span>(</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="dt">dtrackr.strata_glue=</span><span class="st">&quot;{tolower(.value)}&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="dt">dtrackr.strata_sep=</span><span class="st">&quot;, &quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="dt">dtrackr.default_message =</span> <span class="st">&quot;{.count} patients&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="dt">dtrackr.default_headline =</span> <span class="ot">NULL</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>)</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a>ilpd =<span class="st"> </span>dtrackr<span class="op">::</span>ILPD <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="st">  </span><span class="kw">track</span>() <span class="op">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="st">  </span><span class="kw">capture_exclusions</span>() <span class="op">%&gt;%</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="st">  </span><span class="kw">include_any</span>(</span>
<span id="cb2-13"><a href="#cb2-13"></a>    Gender <span class="op">==</span><span class="st"> &quot;Female&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Total_Bilirubin <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.7</span> <span class="op">~</span><span class="st"> &quot;{.included} women with bili&gt;0.7&quot;</span>,</span>
<span id="cb2-14"><a href="#cb2-14"></a>    Gender <span class="op">==</span><span class="st"> &quot;Male&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Total_Bilirubin <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.8</span> <span class="op">~</span><span class="st"> &quot;{.included} men with bili&gt;0.8&quot;</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="st">  </span><span class="kw">group_by</span>(Case_or_Control, <span class="dt">.messages=</span><span class="st">&quot;cases versus controls&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="st">  </span><span class="kw">comment</span>() <span class="op">%&gt;%</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="st">  </span><span class="kw">exclude_all</span>(</span>
<span id="cb2-19"><a href="#cb2-19"></a>    Age<span class="op">&lt;</span><span class="dv">18</span> <span class="op">~</span><span class="st"> &quot;{.excluded} subjects under 18&quot;</span>,</span>
<span id="cb2-20"><a href="#cb2-20"></a>    Age<span class="op">&gt;</span><span class="dv">80</span> <span class="op">~</span><span class="st"> &quot;{.excluded} subjects over 80&quot;</span></span>
<span id="cb2-21"><a href="#cb2-21"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="st">  </span><span class="kw">comment</span>(<span class="dt">.messages =</span> <span class="st">&quot;{.count} after exclusions&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="st">  </span><span class="kw">status</span>(</span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="dt">mean_bili =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%1.2f \u00B1 %1.2f&quot;</span>,<span class="kw">mean</span>(Total_Bilirubin),<span class="kw">sd</span>(Total_Protein)),</span>
<span id="cb2-25"><a href="#cb2-25"></a>    <span class="dt">mean_alb =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%1.2f \u00B1 %1.2f&quot;</span>,<span class="kw">mean</span>(Albumin),<span class="kw">sd</span>(Albumin)),</span>
<span id="cb2-26"><a href="#cb2-26"></a>    <span class="dt">.messages =</span> <span class="kw">c</span>(</span>
<span id="cb2-27"><a href="#cb2-27"></a>      <span class="st">&quot;bilirubin: {mean_bili}&quot;</span>,</span>
<span id="cb2-28"><a href="#cb2-28"></a>      <span class="st">&quot;albumin: {mean_alb}&quot;</span></span>
<span id="cb2-29"><a href="#cb2-29"></a>    )                    </span>
<span id="cb2-30"><a href="#cb2-30"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="st">  </span><span class="kw">ungroup</span>(<span class="dt">.messages =</span> <span class="st">&quot;{.count} in final data set&quot;</span>)</span>
<span id="cb2-32"><a href="#cb2-32"></a></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="co"># restore to originals</span></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="kw">options</span>(old)</span></code></pre></div>
<p>With a bit of experimentation the flowchart needed for a STROBE/CONSORT checklist can be generated. One option to output the flowchart is <code>SVG</code> which can then be manually formatted as required, but for publication ready output <code>pdf</code> is usually preferred.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># saving this flowchart for the JOSS paper.</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># ilpd %&gt;% flowchart(filename = here::here(&quot;vignettes/joss/figure1-ilpd-consort.pdf&quot;))</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>ilpd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">flowchart</span>()</span></code></pre></div>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %0 Pages: 1 -->
<svg width="353pt" height="336pt" viewBox="0.00 0.00 353.47 335.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 331.6)">
<title>%0</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-331.6 349.4692,-331.6 349.4692,4 -4,4"></polygon>
<!-- 10&#45;&gt;12 -->
<g id="edge2" class="edge">
<title>10:s-&gt;12</title>
<path fill="none" stroke="#000000" d="M44.5676,-41.6C44.5676,-41.6 44.5676,-11 44.5676,-11 44.5676,-11 84.8513,-11 84.8513,-11"></path>
<polygon fill="#000000" stroke="#000000" points="84.8514,-12.7501 89.8513,-11 84.8513,-9.2501 84.8514,-12.7501"></polygon>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge1" class="edge">
<title>11:s-&gt;12</title>
<path fill="none" stroke="#000000" d="M218.5676,-41.6C218.5676,-41.6 218.5676,-11 218.5676,-11 218.5676,-11 178.2839,-11 178.2839,-11"></path>
<polygon fill="#000000" stroke="#000000" points="178.2839,-9.2501 173.2839,-11 178.2838,-12.7501 178.2839,-9.2501"></polygon>
</g>
<!-- 8&#45;&gt;10 -->
<g id="edge4" class="edge">
<title>8:s-&gt;10</title>
<path fill="none" stroke="#000000" d="M44.5676,-97.6C44.5676,-97.6 44.5676,-84.9669 44.5676,-84.9669"></path>
<polygon fill="#000000" stroke="#000000" points="46.3177,-84.9669 44.5676,-79.9669 42.8177,-84.9669 46.3177,-84.9669"></polygon>
</g>
<!-- 9&#45;&gt;11 -->
<g id="edge3" class="edge">
<title>9:s-&gt;11</title>
<path fill="none" stroke="#000000" d="M218.5676,-97.6C218.5676,-97.6 218.5676,-84.9669 218.5676,-84.9669"></path>
<polygon fill="#000000" stroke="#000000" points="220.3177,-84.9669 218.5676,-79.9669 216.8177,-84.9669 220.3177,-84.9669"></polygon>
</g>
<!-- 4&#45;&gt;8 -->
<g id="edge6" class="edge">
<title>4:s-&gt;8</title>
<path fill="none" stroke="#000000" d="M44.5676,-149.6C44.5676,-149.6 44.5676,-132.6493 44.5676,-132.6493"></path>
<polygon fill="#000000" stroke="#000000" points="46.3177,-132.6493 44.5676,-127.6493 42.8177,-132.6494 46.3177,-132.6493"></polygon>
</g>
<!-- 4&#45;&gt;6 -->
<g id="edge8" class="edge">
<title>4:e-&gt;6</title>
<path fill="none" stroke="#000000" d="M73.5676,-164C73.5676,-164 82.3128,-164 82.3128,-164"></path>
<polygon fill="#000000" stroke="#000000" points="82.3128,-165.7501 87.3128,-164 82.3128,-162.2501 82.3128,-165.7501"></polygon>
</g>
<!-- 5&#45;&gt;9 -->
<g id="edge5" class="edge">
<title>5:s-&gt;9</title>
<path fill="none" stroke="#000000" d="M218.5676,-149.6C218.5676,-149.6 218.5676,-132.6493 218.5676,-132.6493"></path>
<polygon fill="#000000" stroke="#000000" points="220.3177,-132.6493 218.5676,-127.6493 216.8177,-132.6494 220.3177,-132.6493"></polygon>
</g>
<!-- 5&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>5:e-&gt;7</title>
<path fill="none" stroke="#000000" d="M247.5676,-164C247.5676,-164 256.6988,-164 256.6988,-164"></path>
<polygon fill="#000000" stroke="#000000" points="256.6988,-165.7501 261.6988,-164 256.6987,-162.2501 256.6988,-165.7501"></polygon>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge10" class="edge">
<title>3:s-&gt;4</title>
<path fill="none" stroke="#000000" d="M131.5676,-213C131.5676,-213 44.5676,-213 44.5676,-213 44.5676,-213 44.5676,-184.6488 44.5676,-184.6488"></path>
<polygon fill="#000000" stroke="#000000" points="46.3177,-184.6487 44.5676,-179.6488 42.8177,-184.6488 46.3177,-184.6487"></polygon>
</g>
<!-- 3&#45;&gt;5 -->
<g id="edge9" class="edge">
<title>3:s-&gt;5</title>
<path fill="none" stroke="#000000" d="M131.5676,-213C131.5676,-213 218.5676,-213 218.5676,-213 218.5676,-213 218.5676,-184.6488 218.5676,-184.6488"></path>
<polygon fill="#000000" stroke="#000000" points="220.3177,-184.6487 218.5676,-179.6488 216.8177,-184.6488 220.3177,-184.6487"></polygon>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge11" class="edge">
<title>2:s-&gt;3</title>
<path fill="none" stroke="#000000" d="M131.5676,-243.6C131.5676,-243.6 131.5676,-230.3358 131.5676,-230.3358"></path>
<polygon fill="#000000" stroke="#000000" points="133.3177,-230.3358 131.5676,-225.3358 129.8177,-230.3359 133.3177,-230.3358"></polygon>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge12" class="edge">
<title>1:s-&gt;2</title>
<path fill="none" stroke="#000000" d="M131.5676,-303.8C131.5676,-303.8 131.5676,-291.0351 131.5676,-291.0351"></path>
<polygon fill="#000000" stroke="#000000" points="133.3177,-291.0351 131.5676,-286.0351 129.8177,-291.0351 133.3177,-291.0351"></polygon>
</g>
<!-- 12 -->
<g id="node1" class="node">
<title>12</title>
<polygon fill="#ffffff" stroke="#000000" points="173.4284,-23.4033 89.7068,-23.4033 89.7068,-.1967 173.4284,-.1967 173.4284,-23.4033"></polygon>
<text text-anchor="start" x="96.8876" y="-9.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">460 in final data set</text>
</g>
<!-- 10 -->
<g id="node2" class="node">
<title>10</title>
<polygon fill="#ffffff" stroke="#000000" points="89.2029,-79.6 -.0677,-79.6 -.0677,-41.6 89.2029,-41.6 89.2029,-79.6"></polygon>
<text text-anchor="start" x="7" y="-66.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">case</text>
<text text-anchor="start" x="7" y="-58.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">bilirubin: 4.79 ± 1.07</text>
<text text-anchor="start" x="7" y="-50.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">albumin: 3.03 ± 0.78</text>
</g>
<!-- 11 -->
<g id="node3" class="node">
<title>11</title>
<polygon fill="#ffffff" stroke="#000000" points="263.2029,-79.6 173.9323,-79.6 173.9323,-41.6 263.2029,-41.6 263.2029,-79.6"></polygon>
<text text-anchor="start" x="181" y="-66.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">control</text>
<text text-anchor="start" x="181" y="-58.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">bilirubin: 1.35 ± 1.05</text>
<text text-anchor="start" x="181" y="-50.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">albumin: 3.38 ± 0.78</text>
</g>
<!-- 8 -->
<g id="node4" class="node">
<title>8</title>
<polygon fill="#ffffff" stroke="#000000" points="87.1989,-127.6 1.9363,-127.6 1.9363,-97.6 87.1989,-97.6 87.1989,-127.6"></polygon>
<text text-anchor="start" x="9.002" y="-114.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">case</text>
<text text-anchor="start" x="9.002" y="-106.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">344 after exclusions</text>
</g>
<!-- 9 -->
<g id="node5" class="node">
<title>9</title>
<polygon fill="#ffffff" stroke="#000000" points="261.1989,-127.6 175.9363,-127.6 175.9363,-97.6 261.1989,-97.6 261.1989,-127.6"></polygon>
<text text-anchor="start" x="183.002" y="-114.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">control</text>
<text text-anchor="start" x="183.002" y="-106.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">116 after exclusions</text>
</g>
<!-- 4 -->
<g id="node6" class="node">
<title>4</title>
<polygon fill="#ffffff" stroke="#000000" points="73.1444,-179.6 15.9908,-179.6 15.9908,-149.6 73.1444,-149.6 73.1444,-179.6"></polygon>
<text text-anchor="start" x="22.78" y="-166.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">case</text>
<text text-anchor="start" x="22.78" y="-158.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">357 patients</text>
</g>
<!-- 5 -->
<g id="node7" class="node">
<title>5</title>
<polygon fill="#ffffff" stroke="#000000" points="247.1444,-179.6 189.9908,-179.6 189.9908,-149.6 247.1444,-149.6 247.1444,-179.6"></polygon>
<text text-anchor="start" x="196.78" y="-166.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">control</text>
<text text-anchor="start" x="196.78" y="-158.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">125 patients</text>
</g>
<!-- 6 -->
<g id="node8" class="node">
<title>6</title>
<polygon fill="#cccccc" stroke="#000000" points="175.8184,-183.6 87.3168,-183.6 87.3168,-145.6 175.8184,-145.6 175.8184,-183.6"></polygon>
<text text-anchor="start" x="94.4424" y="-170.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">case</text>
<text text-anchor="start" x="94.4424" y="-162.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">12 subjects under 18</text>
<text text-anchor="start" x="94.4424" y="-154.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">1 subjects over 80</text>
</g>
<!-- 7 -->
<g id="node9" class="node">
<title>7</title>
<polygon fill="#cccccc" stroke="#000000" points="345.371,-183.6 261.7642,-183.6 261.7642,-145.6 345.371,-145.6 345.371,-183.6"></polygon>
<text text-anchor="start" x="268.666" y="-170.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">control</text>
<text text-anchor="start" x="268.666" y="-162.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">7 subjects under 18</text>
<text text-anchor="start" x="268.666" y="-154.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">2 subjects over 80</text>
</g>
<!-- 3 -->
<g id="node10" class="node">
<title>3</title>
<polygon fill="#ffffff" stroke="#000000" points="176.9693,-225.0033 86.1659,-225.0033 86.1659,-201.7967 176.9693,-201.7967 176.9693,-225.0033"></polygon>
<text text-anchor="start" x="93.1168" y="-211" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">cases versus controls</text>
</g>
<!-- 2 -->
<g id="node11" class="node">
<title>2</title>
<polygon fill="#ffffff" stroke="#000000" points="181.1421,-285.9005 81.9931,-285.9005 81.9931,-243.2995 181.1421,-243.2995 181.1421,-285.9005"></polygon>
<text text-anchor="start" x="88.7808" y="-271.8" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">inclusions:</text>
<text text-anchor="start" x="88.7808" y="-262.2" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">128 women with bili&gt;0.7</text>
<text text-anchor="start" x="88.7808" y="-252.6" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">354 men with bili&gt;0.8</text>
</g>
<!-- 1 -->
<g id="node12" class="node">
<title>1</title>
<polygon fill="#ffffff" stroke="#000000" points="160.1444,-327.4033 102.9908,-327.4033 102.9908,-304.1967 160.1444,-304.1967 160.1444,-327.4033"></polygon>
<text text-anchor="start" x="109.78" y="-313.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">583 patients</text>
</g>
</g>
</svg>

</div>
<div id="excluded-data" class="section level1">
<h1>Excluded data</h1>
<p>During this pipeline, we may be keen to understand why certain data items are being rejected. This would enable us to examine the source data, and potentially correct it during the data collection process. We’ve used it to allow continuous quality checks on the data to feed back to the data curators, as we regularly conduct analyses. By tracking the exclusions, not only do we track the data flow through the pipeline we also retain all excluded items, with the reason for exclusion. Thus we can reassure ourselves that the exclusions are as expected. We enabled this by calling <code>capture_exclusions()</code> in the pipeline above. Having tracked the exclusions we can retrieve them by calling <code>excluded()</code> which gives a data frame with the excluded records and the reasons. If the exclusions happened over multiple stages as the dataframe format change in between then this will be held as a nested dataframe (i.e. see <code>?tidyr::nest</code>):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># here we filter out the majority of the actual content of the excluded data to focus on the </span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># metadata recovered during the exclusion.</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>ilpd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">excluded</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(.stage,.message,.filter,Age, Gender)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt; # A tibble: 22 × 5</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt;    .stage  .message             .filter  Age   Gender</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;glue&gt;               &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; </span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt;  1 stage 1 7 subjects under 18  Age &lt; 18 17    Male  </span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt;  2 stage 1 7 subjects under 18  Age &lt; 18 17    Female</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt;  3 stage 1 7 subjects under 18  Age &lt; 18 4     Male  </span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt;  4 stage 1 7 subjects under 18  Age &lt; 18 4     Male  </span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt;  5 stage 1 7 subjects under 18  Age &lt; 18 14    Male  </span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt;  6 stage 1 7 subjects under 18  Age &lt; 18 12    Male  </span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt;  7 stage 1 7 subjects under 18  Age &lt; 18 17    Male  </span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt;  8 stage 1 12 subjects under 18 Age &lt; 18 14    Male  </span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt;  9 stage 1 12 subjects under 18 Age &lt; 18 17    Male  </span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt; 10 stage 1 12 subjects under 18 Age &lt; 18 15    Male  </span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; # … with 12 more rows</span></span></code></pre></div>
<p>This list may have multiple entries for a single data item, if for example something is excluded in any one step for many reasons.</p>
<p>It would be interesting to integrate this into a continuous integration work-flow to run automated checks on data as it is collected.</p>
</div>
<div id="tagging-the-pipeline" class="section level1">
<h1>Tagging the pipeline</h1>
<p>For reporting results it is useful to have the numbers from the flowchart to embed into the text of the results section of the write up. Here we show the same pipeline as above, but with 4 uses of the <code>.tag</code> system for labelling part of the pipeline. This captures data in a tag-value list during the pipeline, and retains it as metadata for later reuse.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a></span>
<span id="cb5-2"><a href="#cb5-2"></a>ilpd =<span class="st"> </span>dtrackr<span class="op">::</span>ILPD <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">  </span><span class="kw">track</span>(<span class="dt">.tag=</span><span class="st">&quot;initial cohort&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="st">  </span><span class="co">#     ^^^^^^^^^^^^^^^^^^^^^</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="st">  </span><span class="co">#     TAGS DEFINED</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="st">  </span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="st">  </span><span class="kw">capture_exclusions</span>() <span class="op">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="st">  </span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="st">  </span><span class="kw">include_any</span>(</span>
<span id="cb5-11"><a href="#cb5-11"></a>    Gender <span class="op">==</span><span class="st"> &quot;Female&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Total_Bilirubin <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.7</span> <span class="op">~</span><span class="st"> &quot;{.included} women with bili&gt;0.7&quot;</span>,</span>
<span id="cb5-12"><a href="#cb5-12"></a>    Gender <span class="op">==</span><span class="st"> &quot;Male&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Total_Bilirubin <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.8</span> <span class="op">~</span><span class="st"> &quot;{.included} men with bili&gt;0.8&quot;</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="st">  </span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="st">  </span><span class="kw">group_by</span>(Case_or_Control, <span class="dt">.messages=</span><span class="st">&quot;cases versus controls&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="st">  </span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="st">  </span><span class="kw">comment</span>(<span class="dt">.tag=</span><span class="st">&quot;study cohort&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="st">  </span><span class="co">#       ^^^^^^^^^^^^^^^^^^^</span></span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="st">  </span><span class="co">#       SECOND SET OF TAGS DEFINED</span></span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="st">  </span></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="st">  </span><span class="kw">exclude_all</span>(</span>
<span id="cb5-22"><a href="#cb5-22"></a>    Age<span class="op">&lt;</span><span class="dv">18</span> <span class="op">~</span><span class="st"> &quot;{.excluded} subjects under 18&quot;</span>,</span>
<span id="cb5-23"><a href="#cb5-23"></a>    Age<span class="op">&gt;</span><span class="dv">80</span> <span class="op">~</span><span class="st"> &quot;{.excluded} subjects over 80&quot;</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb5-25"><a href="#cb5-25"></a><span class="st">  </span></span>
<span id="cb5-26"><a href="#cb5-26"></a><span class="st">  </span><span class="kw">comment</span>(<span class="dt">.messages =</span> <span class="st">&quot;{.count} after exclusions&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-27"><a href="#cb5-27"></a><span class="st">  </span></span>
<span id="cb5-28"><a href="#cb5-28"></a><span class="st">  </span><span class="kw">status</span>(</span>
<span id="cb5-29"><a href="#cb5-29"></a>    <span class="dt">mean_bili =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%1.2f \u00B1 %1.2f&quot;</span>,<span class="kw">mean</span>(Total_Bilirubin),<span class="kw">sd</span>(Total_Protein)),</span>
<span id="cb5-30"><a href="#cb5-30"></a>    <span class="dt">mean_alb =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%1.2f \u00B1 %1.2f&quot;</span>,<span class="kw">mean</span>(Albumin),<span class="kw">sd</span>(Albumin)),</span>
<span id="cb5-31"><a href="#cb5-31"></a>    <span class="dt">.messages =</span> <span class="kw">c</span>(</span>
<span id="cb5-32"><a href="#cb5-32"></a>      <span class="st">&quot;bilirubin: {mean_bili}&quot;</span>,</span>
<span id="cb5-33"><a href="#cb5-33"></a>      <span class="st">&quot;albumin: {mean_alb}&quot;</span></span>
<span id="cb5-34"><a href="#cb5-34"></a>    ),</span>
<span id="cb5-35"><a href="#cb5-35"></a>    <span class="dt">.tag =</span> <span class="st">&quot;qualifying patients&quot;</span></span>
<span id="cb5-36"><a href="#cb5-36"></a>  <span class="co"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span id="cb5-37"><a href="#cb5-37"></a>  <span class="co"># THIRD SET TAGS DEFINED</span></span>
<span id="cb5-38"><a href="#cb5-38"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb5-39"><a href="#cb5-39"></a><span class="st">  </span></span>
<span id="cb5-40"><a href="#cb5-40"></a><span class="st">  </span><span class="kw">ungroup</span>(<span class="dt">.messages =</span> <span class="st">&quot;{.count} in final data set&quot;</span>, <span class="dt">.tag=</span><span class="st">&quot;final set&quot;</span>)</span>
<span id="cb5-41"><a href="#cb5-41"></a>  <span class="co">#                                                 ^^^^^^^^^^^^^^^^</span></span>
<span id="cb5-42"><a href="#cb5-42"></a>  <span class="co">#                                                 LAST TAGS DEFINED</span></span></code></pre></div>
<p>The tagged data can be retrieved as follows, which will give you all tagged data for all 4 points in the pipeline:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>ilpd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tagged</span>() <span class="op">%&gt;%</span><span class="st"> </span>tidyr<span class="op">::</span><span class="kw">unnest</span>(.content)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">#&gt; # A tibble: 6 × 7</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt;   .tag                .count .total .strata   Case_or_Control mean_bili mean_alb</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt;   &lt;chr&gt;                &lt;int&gt;  &lt;int&gt; &lt;chr&gt;     &lt;ord&gt;           &lt;chr&gt;     &lt;chr&gt;   </span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt; 1 initial cohort         583    583 &quot;&quot;        &lt;NA&gt;            &lt;NA&gt;      &lt;NA&gt;    </span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; 2 study cohort           357    482 &quot;Case_or… case            &lt;NA&gt;      &lt;NA&gt;    </span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt; 3 study cohort           125    482 &quot;Case_or… control         &lt;NA&gt;      &lt;NA&gt;    </span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; 4 qualifying patients    344    460 &quot;Case_or… case            4.79 ± 1… 3.03 ± …</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt; 5 qualifying patients    116    460 &quot;Case_or… control         1.35 ± 1… 3.38 ± …</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt; 6 final set              460    460 &quot;&quot;        &lt;NA&gt;            &lt;NA&gt;      &lt;NA&gt;</span></span></code></pre></div>
<p>More often though you will want to retrieve specific values from specific points for the results text for example:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>initialSet =<span class="st"> </span>ilpd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tagged</span>(<span class="dt">.tag =</span> <span class="st">&quot;initial cohort&quot;</span>, <span class="dt">.glue =</span> <span class="st">&quot;{.count} patients&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a>finalSet =<span class="st"> </span>ilpd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tagged</span>(<span class="dt">.tag =</span> <span class="st">&quot;final set&quot;</span>, <span class="dt">.glue =</span> <span class="st">&quot;{.count} patients&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># there were `r initialSet` in the study, of whom `r finalSet` met the eligibility criteria.</span></span></code></pre></div>
<p>For example there were 583 patients in the study, of whom 460 patients met the eligibility criteria.</p>
<p>More complex formatting and calculations are made possible by use of the <code>glue</code> specification, including those that happen on a per group basis, and we can also pull in values from elsewhere in our analysis.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>ilpd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tagged</span>(</span>
<span id="cb8-2"><a href="#cb8-2"></a>    <span class="dt">.tag =</span> <span class="st">&quot;qualifying patients&quot;</span>, </span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="dt">.glue =</span> <span class="st">&quot;{.strata}: {.count}/{.total} ({sprintf(&#39;%1.1f&#39;, .count/.total*100)}%) patients on {sysDate}, with a mean bilirubin of {mean_bili}&quot;</span>, </span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="dt">sysDate =</span> <span class="kw">Sys.Date</span>()</span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="co"># we could have included any number of other parameters here from the global environment</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">pull</span>(.label)</span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt; Case_or_Control:case: 344/460 (74.8%) patients on 2022-07-04, with a mean bilirubin of 4.79 ± 1.07</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; Case_or_Control:control: 116/460 (25.2%) patients on 2022-07-04, with a mean bilirubin of 1.35 ± 1.05</span></span></code></pre></div>
<p>Sometimes it will be necessary to operate on all tagged content at once. This is possible but be aware that the content available depends somewhat on where the tag was set in the pipeline so not all fields will always be present (although <code>.count</code> and <code>.total</code> will be). The <code>.total</code> is the overall number of cases at that point in the pipeline. <code>.count</code> is the number of cases in each strata.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>ilpd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tagged</span>(<span class="dt">.glue =</span> <span class="st">&quot;{.count}/{.total} patients&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">#&gt;   .tag                .strata                   .label          </span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt;   &lt;chr&gt;               &lt;chr&gt;                     &lt;glue&gt;          </span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt; 1 initial cohort      &quot;&quot;                        583/583 patients</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt; 2 study cohort        &quot;Case_or_Control:case&quot;    357/482 patients</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; 3 study cohort        &quot;Case_or_Control:control&quot; 125/482 patients</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt; 4 qualifying patients &quot;Case_or_Control:case&quot;    344/460 patients</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt; 5 qualifying patients &quot;Case_or_Control:control&quot; 116/460 patients</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt; 6 final set           &quot;&quot;                        460/460 patients</span></span></code></pre></div>
<p>For comparing inclusions and exclusions at different stages in the pipeline using tags the following example may be useful:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>ilpd <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="st">  </span><span class="kw">tagged</span>() <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># selects only top level content</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">unnest</span>(.content) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(.tag, .total) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">pivot_wider</span>(<span class="dt">values_from=</span>.total, <span class="dt">names_from=</span>.tag) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="st">  </span>glue<span class="op">::</span><span class="kw">glue_data</span>(<span class="st">&quot;Out of {`initial cohort`} patients, {`study cohort`} were eligible for inclusion on the basis of their liver function tests but {`study cohort`-`qualifying patients`} were </span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="st">                  outside the age limits. This left {`final set`} patients included in the final study (i.e. overall {`initial cohort`-`final set`} were removed).&quot;</span>)</span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">#&gt; Out of 583 patients, 482 were eligible for inclusion on the basis of their liver function tests but 22 were </span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">#&gt; outside the age limits. This left 460 patients included in the final study (i.e. overall 123 were removed).</span></span></code></pre></div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<div id="refs">
<div id="ref-collinsTransparentReportingMultivariable2015">
<p>Collins, Gary S., Johannes B. Reitsma, Douglas G. Altman, and Karel GM Moons. 2015. “Transparent Reporting of a Multivariable Prediction Model for Individual Prognosis or Diagnosis (TRIPOD): The TRIPOD Statement.” <em>BMC Medicine</em> 13 (1): 1. <a href="https://doi.org/10.1186/s12916-014-0241-z">https://doi.org/10.1186/s12916-014-0241-z</a>.</p>
</div>
<div id="ref-Dua2019">
<p>Dua, Dheeru, and Casey Graff. 2017. “UCI Machine Learning Repository.” University of California, Irvine, School of Information and Computer Sciences. <a href="http://archive.ics.uci.edu/ml/">http://archive.ics.uci.edu/ml/</a>.</p>
</div>
<div id="ref-vonelmStrengtheningReportingObservational2008">
<p>Elm, Erik von, Douglas G Altman, Matthias Egger, Stuart J Pocock, Peter C Gøtzsche, Jan P Vandenbroucke, and STROBE Initiative. 2008. “The Strengthening the Reporting of Observational Studies in Epidemiology (STROBE) Statement: Guidelines for Reporting Observational Studies.” <em>Journal of Clinical Epidemiology</em> 61 (4): 344–49.</p>
</div>
<div id="ref-ramanaCriticalStudySelected2011">
<p>Ramana, B., M. Babu, and N. Venkateswarlu. 2011. “A Critical Study of Selected Classification Algorithms for Liver Disease Diagnosis.” <a href="https://doi.org/10.5121/IJDMS.2011.3207">https://doi.org/10.5121/IJDMS.2011.3207</a>.</p>
</div>
<div id="ref-ramanaCriticalComparativeStudy">
<p>Ramana, Bendi Venkata, Prof N. B. Venkateswarlu, and Andhra Pradesh. n.d. “A Critical Comparative Study of Liver Patients from USA and INDIA: An Exploratory Analysis.”</p>
</div>
<div id="ref-schulzCONSORT2010Statement2010">
<p>Schulz, Kenneth F., Douglas G. Altman, and David Moher. 2010. “CONSORT 2010 Statement: Updated Guidelines for Reporting Parallel Group Randomised Trials.” <em>BMJ</em> 340 (March): c332. <a href="https://doi.org/10.1136/bmj.c332">https://doi.org/10.1136/bmj.c332</a>.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
